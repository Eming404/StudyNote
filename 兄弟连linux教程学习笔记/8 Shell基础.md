# 一、Shell概述

​		Shell是一个命令解释器，它为用户提供了一个向Linux内核发送请求以便运行程序的界面系统级程序，用于可以用Shell来启动、挂起、停止甚至时编写一些程序。

​		同时，Shell还是一个功能强大的编程语言，易编写、易调试，灵活性较强。Shell是解释执行的脚本语言，在Shell中可以直接调用Linux系统命令。

​		Shell分为Bourne Shell与C Shell，两种语法彼此不兼容。Bourne家族主要包括sh、ksh、Bash、psh、zsh，C家族主要包括csh、tcsh。Bash与sh兼容，现在使用的Linux是使用Bash作为用户的基本Shell。可在/etc/shells目录下查看支持的shell文件，其中/sbin/nologin用于不允许登录的用户。

# 二、Shell脚本的执行方式

## 2.1 echo输出命令

- 命令格式：``echo [选项] [输出内容]``
- 选项：-e，表示支持反斜杠控制的字符转换
- 示例：``echo 'Hello World'``

反斜线可用的转义字符：

| 控制字符 | 作用                                                         |
| -------- | ------------------------------------------------------------ |
| \\\      | 输出\\本身                                                   |
| \a       | 输出警告音                                                   |
| \b       | 退格键，即向左删除                                           |
| \c       | 取消输出行末的换行符，和"-n"选项一致                         |
| \e       | ESCAPE键                                                     |
| \f       | 换页符                                                       |
| \n       | 换行符                                                       |
| \r       | 回车键                                                       |
| \t       | 制表符，即Tab键                                              |
| \v       | 垂直制表符                                                   |
| \0nnn    | 按照八进制ASCII码表输出字符，其中0为数字零，nnn是三位八进制数 |
| \xhh     | 按照十六进制ASCII码表输出字符，其中hh是两位十六进制数        |

示例：

- ``echo -e "ab\bc"`` ：运行结果为ac
- ``echo -e "\e[1;31m abcd \e[0m"`` ：表示输出红色abcd，其中”\e[1;“表示开启颜色输出，“\e[0m”表示结束颜色输出，31m表示颜色
  - 可选颜色：30m至37m分别为黑色、红色、绿色、黄色、蓝色、洋红、青色、白色

## 2.2 第一个脚本

```shell
[root@localhost sh]# vi hello.sh
#!/bin/Bash			# 此处#不是注释，而是表示接下来的语句是Shell语句
# The first program	# 接下来的内容为注释
# Author:HuangYuan
echo 'Hello Shell!'
```

## 2.3 脚本执行

- 赋予执行权限，直接运行
  - ``chmod 755 hello.sh`` ，赋予运行权限，然后``./hello.sh`` 命令运行。
- 通过bash调用执行脚本
  - ``bash hello.sh`` 

# 三、Bash的基本功能

## 3.1 历史命令

- ``history `` 命令
  - 语法：``history [选项] [历史命令保存文件]``
  - -c：清空历史记录
  - -w：把缓存中的历史命令写入历史命令保存文件
  - 默认历史命令保存路径为~/.bash_history
  - 默认保存1000条历史，可在环境变量配置文件/etc/profile中进行修改

- 历史命令的调用
  - 使用上下箭头用以前的历史命令
  - 使用“!n”重复执行第n条历史命令
  - 使用“!!“重复执行上一条命令
  - 使用”!字符串“重复执行最后一条以该字符串开头的命令

## 3.2 命令与文件补全

​		在Bash中，命令与文件补全是非常方便与常用的功能，我们只要在输入命令或文件时，按Tab键就会自动进行补全。

## 3.3 命令别名

- ``alias 别名=‘原命令’`` 设定命令别名；``alias`` 查看命令别名；``unalias`` 删除别名
- 命令执行顺序：
  - 第一顺位执行用绝对路径或相对路径执行的命令
  - 第二顺位执行别名
  - 第三顺位执行Bash的内部命令
  - 第四顺位执行按照$PATH环境变量定义的目录查找顺序找到的第一个命令
- 让别名永久生效：``vi /root/.bashrc``

## 3.4 Bash常用快捷键

| 快捷键 |         作用          |
| :----: | :-------------------: |
| ctrl+A | 把光标移动到命令开头  |
| ctrl+E | 把光标移动到命令结尾  |
| ctrl+C |   强制终止当前命令    |
| ctrl+L | 清屏，相当于clear命令 |
| ctrl+U |  剪切光标之前的内容   |
| ctrl+K |  剪切光标之后的内容   |
| ctrl+Y |    粘贴剪切的内容     |
| crtl+R |   在历史记录中搜索    |
| ctrl+D |     退出当前终端      |
| ctrl+Z |   暂停，并放入后台    |
| ctrl+S |     暂停屏幕输出      |
| crtl+Q |     恢复屏幕输出      |

## 3.5 输入重定向

- 标准输入输出

|  设备  | 设备文件名  | 文件描述符 |     类型     |
| :----: | :---------: | :--------: | :----------: |
|  键盘  | /dev/stdin  |     0      |   标准输入   |
| 显示器 | /dev/sdtout |     1      |   标准输出   |
| 显示器 | /dev/sdterr |     2      | 标准错误输出 |

- 输出重定向

|           类型           |       符号        | 作用                                                   |
| :----------------------: | :---------------: | ------------------------------------------------------ |
|      标准输出重定向      |    命令 > 文件    | 以覆盖的方式，把命令的正确输出输出到指定的文件或设备中 |
|      标准输出重定向      |    命令>>文件     | 以追加的方式，把命令的正确输出输出到指定的文件或设备中 |
| 标准错误<br />输出重定向 | 错误命令 2> 文件  | 覆盖（2和>之间不能有空格）                             |
| 标准错误<br />输出重定向 | 错误命令 2>> 文件 | 追加                                                   |

- 正确输出和错误输出同时保存

|          命令           |                       作用                       |
| :---------------------: | :----------------------------------------------: |
|    命令 > 文件 2>&1     |                       覆盖                       |
|    命令 >> 文件 2>&1    |                       追加                       |
|      命令 &> 文件       |                       覆盖                       |
|      命令 &>> 文件      |                       追加                       |
| 命令 >> 文件1 2>> 文件2 | 把正确输出追加到文件1<br />把错误输出追加到文件2 |

有时运行``命令 &>> /dev/null`` ，将运行结果丢到null文件中，即不显示也不保存命令运行结果

## 3.6 输出重定向

- ``wc [选项] [文件名]`` 
  - -c：统计字节数
  - -w：统计单词数
  - -l：统计行数
- ``wc`` 统计键盘输入。输入需统计内容后ctrl+D退出
- ``wc < 文件`` 统计文件

## 3.7 多命令顺序执行

| 执行符 |      格式      |                             作用                             |
| :----: | :------------: | :----------------------------------------------------------: |
|   ；   |  命令1；命令2  |          多个命令顺序执行，命令之间没有任何逻辑联系          |
|   &&   |  命令1&&命令2  | 当命令1正确执行，则命令2才会执行<br />当命令1执行不正确，则命令2不会执行 |
|  \|\|  | 命令1\|\|命令2 | 当命令1执行不正确，则命令2才会执行<br />当命令1正确执行，则命令2不会执行 |

- 磁盘复制命令
  - ``dd if=输入文件 of=输出文件 bs=blocd_size count=block个数``
  - if：指定源文件或源设备
  - of：指定目标文件或目标设备
  - bs：指定以此输入/输出多大内存的数据块
  - count：指定输入/输出多少个数据块
  - ``date ; dd if=/dev/zero of=/root/testfile bs=1k count=100000 ; date`` 可测试复制文件需要多少时间。

- ``命令 && echo yes || echo no`` 实现类似三目运算符的功能。

## 3.8 管道符

- ``命令1 | 命令2 `` 命令1的正确输出作为命令2的操作对象。
- `` ll -a /etc | more `` 分页显示/etc目录下的文件详细信息
- ``netstat -an | grep "ESTABLISHED"`` 

grep命令：

- ``grep [] “搜索内容”`` 在文件中搜索指定内容
  -  -i：忽略大小写
  - -n：输出行号
  - -v：反向查找
  - --color=auto：搜索出的关键字用颜色显示

## 3.9 通配符与其它特殊符号

- 通配符

| 通配符 | 作用                                                         |
| :----: | ------------------------------------------------------------ |
|   ？   | 匹配一个字符                                                 |
|   *    | 匹配0个或多个任意字符，也就是可以匹配任何内容                |
|   []   | 匹配中括号中任意一个字符。例如[abc]代表匹配a、b、c内的任意一个字符 |
|  [-]   | 匹配括号中任意一个字符，-代表范围。例如[a-z]代表匹配一个小写字母 |
|  [^]   | 逻辑非，表示匹配不是中括号内的一个字符。例如[\^0-9]代表匹配一个非数字字符 |

- Bash中其它特殊符号

| 符号 | 作用                                                         |
| :--: | ------------------------------------------------------------ |
| ' '  | 单引号。在单引号中的所有特殊符号，如“$”和“`”（反引号）都没有特殊含义。 |
| “ ”  | 双引号。双引号中的特殊符号都没有特殊含义，但是"$"、“`”、“\”是例外，分别拥有“调用变量的值”、“引用命令”、“转义字符”的特殊含义。 |
|  ``  | 反引号。反引号括起来的内容是系统命令，在Bash中会先执行命令。 |
| &()  | $()作用同反引号，用来引用系统命令                            |
|  #   | 在Shell脚本中，#开头的行表示注释                             |
|  $   | 调用变量的值                                                 |
|  \   | 转义字符，使其后面紧跟的特殊符号失去特殊含义，变为普通字符   |

# 四、Bash变量

## 4.1 变量设置规则

- 变量名不能以数字开头。
- 在Bash中，变量的默认类型都是字符串型，如果想要进行数值运算，则必须修改指定变量类型为数值型。
- 变量用等号值连接，等号左右两侧不能有空格；如果变量的值有空格，则需要使用引号包括。
- 变量的值中可以使用“\”转义符。
- 变量的值可以进行叠加，不过需要用双引号包含“\$变量名”或\${变量名}包含。
- 如果要把命令的结果作为变量值赋予变量，则需使用反引号或$()包含命令。
- 环境变量名建议大写，便于区分。

## 4.2 变量分类

- 用户自定义变量
- 环境变量：主要保存和系统操作环境相关的数据。
- 位置参数变量：用于向脚本当中传递参数或数据，变量名不能自定义，变量作用是固定的。
- 预定义变量：是Bash中已经定义好的变量，变量名不能自定义，变量作用固定。

## 4.3 本地变量——用户自定义变量

- 定义：``name="Hello World`` 
- 变量叠加：``aa="$aa"456`` 或``aa=\${aa}456``
- 变量调用：``echo $name``
- 变量查看：``set`` 查看系统中的全部变量
- 变量删除：``unset name`` 

## 4.4 环境变量

- 用户自定义变量只在当前的Shell中生效，而环境变量会在当前Shell和这个Shell的所有子Shell中生效。如果把环境变量写入相应的配置文件，那么这个环境变量就会在所有的Shell中生效。
- ``export 变量名=变量值`` 申明变量
- ``env`` 查询变量

- ``unset 变量名`` 删除变量
- 系统常见环境变量
  - PATH：系统查找命令的路径。
    - ``PATH="$PATH":/root/sh`` 将/root/sh目录添加进环境变量，这样可以直接通过文件名执行文件，而不需要绝对路径。
  - PS1：定义系统提示符的变量。

## 4.5 位置参数变量

| 位置参数变量 | 作用                                                         |
| :----------: | ------------------------------------------------------------ |
|      $n      | n为数字，\$0表示命令本身，\$1-$9代表第一到第九个参数，十以上的参数需要用大括号包含。 |
|      $*      | 这个变量代表命令行中所有的参数，$*把所有的参数看成一个整体   |
|      $@      | 这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待   |
|      $#      | 这个变量代表命令行中所有的参数的个数                         |

## 4.6 预定义变量

| 预定义变量 | 作用                                                         |
| :--------: | ------------------------------------------------------------ |
|     $?     | 最后一次执行的命令的返回状态。如果这个变量值为0，则表明上一个命令正确执行；变量值为非零，则上一个命令错误执行。 |
|     $$     | 当前进程的进程号(PID)                                        |
|     $!     | 后台运行的最后一个进程的进程号(PID)                          |

- 接收键盘输入
  - ``read [选项] [变量名]`` 
  - ``-p 提示信息`` ：在等待read输入时，输出提示信息
  - ``-t 秒数`` ：read命令会一直等待用户输入，使用此选项可以指定等待时间
  - ``-n 字符数`` ：read只接受指定的字符数，就会执行
  - ``-s`` ：隐藏输入的数据，适用于机密信息的输入

- ``echo -e "\n"`` ：输出换行符

# 五、Bash运算符

- ``declare [+/-][选项] [变量名]`` 声明变量类型
  - -：给变量设定类型属性
  - +：取消变量的类型属性
  - -i：将变量声明为整数型
  - -x：将变量声明为环境变量
  - -p：显示指定变量的被声明的类型

- 使用expr或let数值运算工具
  - ``dd=$(expr $aa + $bb)`` 但小括号表明取出小括号内的命令执行结果
  - +号左右两侧必须有空格
  - expr和let用法相同
- ``$((运算式))`` 或``$[运算式]``

- 运算符

| 优先级 |                 运算符                 |                说明                |
| :----: | :------------------------------------: | :--------------------------------: |
|   13   |                  - +                   |             单目负、正             |
|   12   |                  ！ ~                  |       逻辑非，按位取反或补码       |
|   11   |                 * / %                  |            乘、除、取模            |
|   10   |                  + -                   |               加、减               |
|   9    |                 <<  >>                 |         按位左移，按位右移         |
|   8    |              <=  >=  <  >              | 小于或等于，大于或等于，小于，大于 |
|   7    |                 ==  !=                 |            等于，不等于            |
|   6    |                   &                    |               按位与               |
|   5    |                   ^                    |              按位异或              |
|   4    |                   \|                   |               按位或               |
|   3    |                   &&                   |               逻辑与               |
|   2    |                  \|\|                  |               逻辑或               |
|   1    | =，+=，-<br />*=，/=，^=<br />\|=，<<= |          赋值，运算且赋值          |

- 小括号可以更改优先级

# 六、环境变量配置文件

## 6.1 简介

​		环境变量配置文件中主要是定义对系统的操作环境生效的系统默认环境变量，比如PATH、HISTSIZE、PS1、HOSTNAME等默认环境变量。环境变量一般大写。用户自定义环境变量配置只能写入配置文件才能永久生效。

- `source [配置文件]` 或`. 配置文件` ，使配置文件立即生效，不需重新登录。其中"."相当于source，需要在配置文件前添加空格。  

- `PATH="$PATH":/root` ：使用变量叠加的方式，将root目录追加到环境变量中。

## 6.2 主要的配置文件

- 对所有用户生效
  - /etc/profile
  - /etc/profile.d/*.sh
  - /etc/bashrc
- 单个用户生效。"~"表示用户家目录
  - ~/.bash_profile
  - ~/.bashrc

## 6.3 配置文件的作用

​		登录时调用的环境变量配置文件顺序为：

![](/figure/环境变量配置文件.png)

## 6.4 其他配置文件和登录信息

- ~/.bash_logout：注销时生效的环境变量配置文件
- ~/.bash_history：历史命令保存文件

- Shell登录信息
  - /etc/issue：本地终端登陆前欢迎信息
  - /etc/issue.net：远程终端登陆前欢迎信息
  - /etc/motd：登陆后的欢迎信息

